"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var a=0,i=Array(t.length);a<t.length;a++)i[a]=t[a];return i}return Array.from(t)}!function(l){DRTS.Voting=DRTS.Voting||{},DRTS.Voting.onSendData=function(t,a,i){if(a.data("success-label")){var e=a.find(".drts-voting-vote-label");e.length?(a.data("original-label",e.text()),e.text(a.data("success-label"))):(a.data("original-label",a.attr("data-original-title")),a.attr("data-original-title",a.data("success-label")))}a.find("i").attr("class",a.data(a.hasClass(DRTS.bsPrefix+"active")?"voting-icon":"voting-icon-active")),l(DRTS).trigger("voting_vote_entity_send_data.sabai",{type:t,trigger:a,data:i})},DRTS.Voting.onSuccess=function(t,a,i){a.data("original-label")&&a.data("success-label",a.data("original-label")).removeData("original-label"),a.closest('.drts-display-element[data-name="button"], .drts-display-element-buttons').find('button[data-voting-type="'+t+'"]').each(function(){var t=l(this),a=i.value==t.data("active-value");t.toggleClass(DRTS.bsPrefix+"active",a).find("i").attr("class",t.data(a?"voting-icon-active":"voting-icon")),t.find(".drts-voting-vote-num").length&&t.find(".drts-voting-vote-num").text(t.data("active-value")<0?i.num_down:i.num)}),l(DRTS).trigger("voting_vote_entity_success.sabai",{type:t,trigger:a,result:i})},DRTS.Voting.onError=function(t,a,i){if(a.data("original-label")){var e=a.find(".drts-voting-vote-label");e.length?e.text(a.data("original-label")):a.attr("data-original-title",a.data("original-label")),a.removeData("original-label")}a.find("i").attr("class",a.data(a.hasClass(DRTS.bsPrefix+"active")?"voting-icon-active":"voting-icon")),l(DRTS).trigger("voting_vote_entity_error.sabai",{type:t,trigger:a,error:i})},DRTS.Voting.button=function(t){var a=l(t);if(a.length&&a.data("voting-type")&&a.data("entity-type")&&a.data("entity-id")){var o="drts-voting-"+a.data("voting-type")+"-"+a.data("entity-type")+"-"+DRTS.cookieHash,i=String(a.data("entity-id")),r=a.data("voting-expires-days")?a.data("voting-expires-days"):2e3,e=function(t,a){var i,e,n=l.cookie(o);return e=-1!==(i=(n=n?n.split("/"):[]).indexOf(t)),a&&(!1===e?(n.push(t),100<=n.length&&(n=n.slice(n.length-100,n.length))):n.splice(i,1),DRTS.setCookie(o,[].concat(_toConsumableArray(new Set(n))).join("/"),r),e=!e),e},n=function(t,a){var i,e;e=a?(t.addClass(DRTS.bsPrefix+"active"),i=t.data("label-active"),t.data("voting-icon-active")):(t.removeClass(DRTS.bsPrefix+"active"),i=t.data("label"),t.data("voting-icon")),t.find(".drts-voting-vote-label").text(i).end().find("i").attr("class",e)};n(a,e(i)),a.on("click",function(){var t=e(i,!0);n(a,t),l(DRTS).trigger("voting_vote_entity_button_clicked.sabai",{type:a.data("voting-type"),button:a,voted:t})})}},l(DRTS).on("drts_init.sabai",function(t,a){l('.drts-voting-button[data-voting-guest="1"]',a.context).each(function(){DRTS.Voting.button(l(this))})})}(jQuery);