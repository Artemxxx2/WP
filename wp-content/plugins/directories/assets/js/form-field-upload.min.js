"use strict";!function(d){DRTS.Form.field.upload=function(l){l=d.extend({selector:"",maxNumFiles:0,maxNumFileExceededError:"",inputName:"files",sortable:!0,formData:{},deleteConfirm:"Are you sure?",sortableHandle:!1,upload:!0,flashPosition:"center"},l);var e=d(l.selector);if(e.length){var t=e.closest(".drts-form-upload-container"),a=t.find("."+DRTS.bsPrefix+"progress"),s=a.find("."+DRTS.bsPrefix+"progress-bar"),o=0,n=0;l.upload&&e.fileupload({url:l.url,dataType:"json",paramName:"drts_form_upload",formData:l.formData,singleFileUploads:!0,sequentialUploads:!0,send:function(e,r){if(document.dispatchEvent(new CustomEvent("file-upload-start",{detail:t.data("form-field-name")})),l.maxNumFiles&&o+r.files.length>l.maxNumFiles)return l.maxNumFileExceededError&&DRTS.flash(l.maxNumFileExceededError,"danger",null,l.flashPosition),!1;a.is(":hidden")&&(s.attr("aria-valuenow",0).css("width","0%").text("0%").addClass(DRTS.bsPrefix+"progress-bar-striped "+DRTS.bsPrefix+"progress-bar-animated"),a.show())},fail:function(e,r){a.removeClass(DRTS.bsPrefix+"progress-bar-striped "+DRTS.bsPrefix+"progress-bar-animated").hide()},done:function(e,r){if(r.result.error)return a.removeClass(DRTS.bsPrefix+"progress-bar-striped "+DRTS.bsPrefix+"progress-bar-animated").hide(),void DRTS.flash(r.result.error,"danger",null,l.flashPosition);o+=r.files.length;var i=t.find(".drts-form-upload-current").find("table");d.each(r.result.files,function(e,r){var t=d('<tr class="drts-form-upload-row"/>'),a=d('<input type="hidden"/>').attr("name",l.inputName+"[current]["+r.id+"][check][]").val(r.id),s=d('<input class="'+DRTS.bsPrefix+'form-control" type="text">').attr("name",l.inputName+"[current]["+r.id+"][name]").val(r.title),o=d('<a target="_blank"/>').attr("href",r.url),n=d('<a href="#" class="drts-form-upload-row-delete '+DRTS.bsPrefix+"btn "+DRTS.bsPrefix+"btn-sm "+DRTS.bsPrefix+'btn-danger"/>').html('<i class="fas fa-times"></i>');r.thumbnail?d('<td style="text-align:center;"/>').html(o.html(d("<img/>").attr("src",r.thumbnail))).appendTo(t):d('<td style="text-align:center;"/>').html(o.html(d("<i/>").attr("class",r.icon))).appendTo(t),d("<td/>").html(s).appendTo(t),d("<td/>").text(r.size_hr).appendTo(t),d('<td style="text-align:center;"/>').html(a).prepend(n).appendTo(t),i.has(".drts-form-upload-row").length||i.find("tbody").empty(),t.appendTo(i.find("tbody"))}),100===n&&(l.sortable&&DRTS.init(i.find("tbody").sortable("destroy").sortable({containment:"parent",axis:"y"}).parent()),a.removeClass(DRTS.bsPrefix+"progress-bar-striped "+DRTS.bsPrefix+"progress-bar-animated").hide())},progressall:function(e,r){n=parseInt(r.loaded/r.total*100,10),s.attr("aria-valuenow",n).css("width",n+"%").text(n+"%")},always:function(e,r){document.dispatchEvent(new CustomEvent("file-upload-end",{detail:t.data("form-field-name")}))}}),t.on("click",".drts-form-upload-row-delete",function(){if(!confirm(l.deleteConfirm))return!1;var e=d(this).closest(".drts-form-upload-row");return e.fadeTo("fast",0,function(){e.slideUp("fast",function(){--o,e.remove()})}),!1}),e.closest("form").submit(function(){if(l.maxNumFiles&&t.find('.drts-form-upload-current tbody input[type="checkbox"]:checked').length>l.maxNumFiles)return l.maxNumFileExceededError&&alert(l.maxNumFileExceededError),!1}),l.sortable&&t.find(".drts-form-upload-current tbody").sortable({containment:"parent",axis:"y",handle:l.sortableHandle,cursor:"move"})}}}(jQuery);