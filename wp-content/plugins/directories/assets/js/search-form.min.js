"use strict";!function(k){DRTS.Search=DRTS.Search||{},DRTS.Search.keyword=DRTS.Search.keyword||function(t){var p=k(t);if(p.length){var o=p.find(".drts-search-keyword-text");if(o.length){var n,i=p.find(".drts-clear").css("visibility",0<o.val().length?"visible":"hidden"),e=p.closest(".drts-search-form"),a=e.find(".drts-search-keyword-id"),r=e.find(".drts-search-keyword-taxonomy"),y=[],u={suggest_post:!0===p.data("suggest-post"),suggest_post_url:p.data("suggest-post-url")||"",suggest_taxonomy:p.data("suggest-taxonomy"),suggest_min_length:p.data("suggest-min-length")||2},f=function(t,e,s){var o,n;return t.icon_src?o=k("<img/>").attr("class","drts-icon drts-icon-sm").attr("src",t.icon_src):(n=t.icon||!!s&&t.parent_icon||e)&&(o=k("<i/>").attr("class","drts-icon drts-icon-sm "+n),t.color&&o.css({"background-color":t.color,color:"#fff"})),o};if(u.suggest_post&&u.suggest_post_url){var d,s=p.data("suggest-post-header")||"",l=p.data("suggest-post-icon")||null,c=p.data("suggest-post-num")||5,g=p.data("suggest-post-wildcard")||"QUERY",h={},m={datumTokenizer:Bloodhound.tokenizers.obj.whitespace("title"),queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{wildcard:g,url:u.suggest_post_url},sufficient:c,identify:function(t){return t.id}};p.data("suggest-post-prefetch-url")&&(m.prefetch={url:p.data("suggest-post-prefetch-url")}),d=new Bloodhound(m),s&&(h.header=k("<h4/>").text(s)[0].outerHTML),h.suggestion=(n=l,function(t){var e=k("<div/>").html(k("<span />").text(t.title)),s=f(t,n);return s&&e.prepend(s),e[0].outerHTML}),y.push({name:"post",display:"title",templates:h,source:function(t,e,s){t.length>=u.suggest_min_length&&d.search(t,e,s)}})}if(u.suggest_taxonomy){var v=u.suggest_taxonomy.split(",");v&&v.length&&k.each(v,function(t,e){var n,s=p.data("suggest-taxonomy-"+e+"-url");if(s){var o={},i=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("title","pt"),queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:{url:s}}),a=p.data("suggest-taxonomy-"+e+"-header");a&&(o.header=k("<h4/>").text(a)[0].outerHTML);var r=p.data("suggest-taxonomy-"+e+"-icon"),u=p.data("suggest-taxonomy-"+e+"-count"),d=p.data("suggest-taxonomy-"+e+"-parents");o.suggestion=(n=r,function(t){var e,s,o=t.title;return u&&(o=o+" ("+(t.count||"0")+")"),d&&t.pt&&(o=t.pt.join(" -> ")+" -> "+o),e=k("<div/>").html(k("<span>").text(o)),n&&(s=f(t,n,!0))&&e.prepend(s),e[0].outerHTML}),y.push({name:e,source:function(t,e,s){0<t.length&&i.search(t,e,s)},display:"title",templates:o,limit:p.data("suggest-taxonomy-"+e+"-num")||100})}var l,c=p.data("suggest-taxonomy-top-"+e+"-url");if(c){var g={},h=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("title"),queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:{url:c}});r=p.data("suggest-taxonomy-"+e+"-icon"),u=p.data("suggest-taxonomy-"+e+"-count");g.suggestion=(l=r,function(t){var e,s=t.title,o=f(t,l,!0);return u&&(s=s+" ("+(t.count||"0")+")"),e=k("<div/>").html(k("<span>").text(s)),o&&e.prepend(o),e[0].outerHTML}),y.push({name:"top-"+e,source:function(t,e,s){t.length||e(h.all())},display:"title",templates:g,limit:100})}})}y.length?(o.typeahead({highlight:!0,minLength:u.suggest_taxonomy?0:u.suggest_min_length},y),o.on("typeahead:select",function(t,e,s){if("post"!==s?(console.log(s),0===s.indexOf("top-")&&(s=s.substr(4),i.css("visibility",0<o.val().length?"visible":"hidden")),r.val(s)):r.val(""),e.url)return o.closest("form").find("button[type=submit]").prop("disabled",!0),void(window.location.href=e.url);a.val(e.id),o.trigger("change").blur()}).on("keyup",function(t){13!==t.keyCode&&27!==t.keyCode&&32!==t.keyCode&&(r.val(""),a.val(""),i.css("visibility",0<o.val().length?"visible":"hidden"))}).on("typeahead:render",function(){o.closest(".twitter-typeahead").addClass("twitter-typeahead-open")}).on("typeahead:close",function(){o.closest(".twitter-typeahead").removeClass("twitter-typeahead-open")}),i.click(function(){o.typeahead("val","").focus(),r.val(""),a.val(""),i.css("visibility","hidden")})):(o.on("keyup",function(t){13!==t.keyCode&&27!==t.keyCode&&32!==t.keyCode&&i.css("visibility",0<o.val().length?"visible":"hidden")}),i.click(function(){o.val("").focus(),i.css("visibility","hidden")}))}}}}(jQuery);