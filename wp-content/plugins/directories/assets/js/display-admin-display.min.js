"use strict";var _createClass=function(){function l(e,t){for(var a=0;a<t.length;a++){var l=t[a];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}return function(e,t,a){return t&&l(e.prototype,t),a&&l(e,a),e}}();function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(c){function a(e,t){var n=this;_classCallCheck(this,a),this.form=c(e),this.options=c.extend({addDisplayUrl:null,elementTypes:{},addElementTitle:null,editElementTitle:null,deleteConfirm:null,saveChangesAlert:null},t),this.submitRequired=[],c(".drts-display-add-display").on("click",function(e){if(n.isSubmitRequired())alert(n.options.saveChangesAlert);else{var t=c(e.currentTarget);DRTS.ajax({type:"get",container:"#drts-modal",modalSize:"xl",url:n.options.addDisplayUrl,data:{display_type:t.data("display-type"),display_name:t.data("display-name")},trigger:t,cache:!0,cacheId:n.options.addDisplayUrl+t.data("display-type")+"-"+t.data("display-name")})}}),c(".drts-display-delete-display").on("click",function(e){var t=c(e.currentTarget).parent(".drts-display-tab2-link");if(t.length){if(!confirm(n.options.deleteConfirm))return!1;var a={display_type:t.data("display-type"),display_name:t.data("display-name")};return a[DRTS.params.token]=n.form.find('input[name="'+DRTS.params.token+'"]').val(),DRTS.ajax({type:"post",url:n.options.deleteDisplayUrl,data:a,trigger:t,onSuccess:function(e,t,a){a.fadeTo("fast",0,function(){a.slideUp("fast",function(){a.remove()}),a.hasClass(DRTS.bsPrefix+"active")&&a.parent().find(".drts-display-tab2-link-default").click()});var l=a.closest("."+DRTS.bsPrefix+"tab-pane").find(".drts-display-add-display");l.length&&(console.log(n.options.addDisplayUrl+l.data("display-type")+"-"+l.data("display-name")),DRTS.cache(n.options.addDisplayUrl+l.data("display-type")+"-"+l.data("display-name"),!1))}}),!1}}),this.form.on("submit",function(e){n.submitRequired=[]}),c(window).on("beforeunload",function(e){if(n.isSubmitRequired())return""})}DRTS.Display=DRTS.Display||{},DRTS.Display.adminDisplays=(_createClass(a,[{key:"addDisplay",value:function(e,t){DRTS.Display.adminDisplay(this,e,c.extend({},this.options,t))}},{key:"isSubmitRequired",value:function(e,t){if(!e)return 0<this.submitRequired.length;var a=this.submitRequired.indexOf(e);if(-1!==a){if(!1===t)this.submitRequired.splice(a,1);else if(!0!==t)return!0}else if(!0===t)this.submitRequired.push(e);else if(!1!==t)return!1}}]),a),DRTS.Display.adminDisplay=function(e,t,o){o=c.extend({selector:t,name:"elements",listElementsUrl:null,addElementUrl:null,editElementUrl:null,deleteElementTitle:null,configureInline:!1},o);function a(){var e,t=c(this);if(r(),t.sabaiTooltip("hide"),o.configureInline){var a=t.closest(".drts-display-element");e=a.length?"#drts-display-element-settings-inline-"+a.data("element-id"):"#drts-display-element-settings-inline-0"}else e="#drts-modal",t.attr("data-modal-title",t.data("element-type")&&1===t.data("element-type").length?o.addElementTitle+" - "+o.elementTypes[t.data("element-type")[0]]:o.addElementTitle);return DRTS.ajax({type:"get",container:e,modalSize:"xl",url:o.listElementsUrl,data:t.data("element-type")?{type:t.data("element-type")}:null,onErrorFlash:!0,onContent:function(e,t,a){t.find(".drts-display-elements").off("click",".drts-display-element",s).on("click",".drts-display-element",{parentId:a.closest(".drts-display-element").data("element-id")||0},s)},trigger:t,cache:!0,cacheId:t.data("element-type")?o.listElementsUrl+"-"+JSON.stringify(t.data("element-type")):o.listElementsUrl,slideDown:!0,scroll:o.configureInline}),!1}function l(){var e,t=c(this),l=t.closest(".drts-display-element");return l.addClass("drts-display-element-editing"),r(),o.configureInline?e="#drts-display-element-settings-inline-"+l.data("element-id"):(e="#drts-modal",t.attr("data-modal-title")||t.attr("data-modal-title",(l.data("element-type")&&1===l.data("element-type").length?o.editElementTitle+" - "+o.elementTypes[l.data("element-type")[0]]:o.editElementTitle)+" - "+l.data("element-label")+" (ID: "+l.data("element-id")+")")),DRTS.ajax({type:"get",container:e,modalSize:"xl",url:o.editElementUrl,data:{element_id:l.data("element-id")},onContent:function(e,t,a){l.removeClass("drts-display-element-editing"),o.configureInline&&l.addClass("drts-display-element-editing-inline")},onErrorFlash:!0,trigger:t,cache:!0,cacheId:"drts-display-element-id-"+l.data("element-id"),slideDown:!0}),!1}function i(e){e.hasClass("drts-display-element-containable")?e.find("> .drts-display-element-title").effect("highlight",{},1e3):e.effect("highlight",{},1e3)}var n,s=function(e){e.data=e.data||{};var t,a=c(this),l=a.closest(".drts-display-element"),n=e.data.parentId||l.data("element-id")||0;return r(),a.sabaiTooltip("hide"),o.configureInline?(a.addClass("drts-bs-active"),t="#drts-display-element-settings-inline-"+n):(t="#drts-modal",a.attr("data-modal-title",(l.data("element-type")&&1===l.data("element-type").length?o.addElementTitle+" - "+o.elementTypes[l.data("element-type")[0]]:o.addElementTitle)+" - "+l.data("element-label"))),DRTS.ajax({type:"get",container:t,modalSize:"xl",url:o.addElementUrl,data:{element:a.data("element-name")},onSendData:function(e,t){},onContent:function(e,t,a){t.find("#drts-display-add-element-parent").val(n)},onErrorFlash:!0,trigger:a,cache:!0,cacheId:"drts-display-element-name-"+a.data("element-name"),slideDown:!0}),!1},m=function(e,t,a){var l=e.find("> .drts-display-element-title");t.title&&t.title.length?l.find(".drts-display-element-label").html(t.title).toggleClass("drts-display-element-no-label",t.no_title):l.find(".drts-display-element-label").text(t.label).addClass("drts-display-element-no-label"),a&&t.icon&&l.prepend('<span class="drts-display-element-icon"><i class="fa-fw '+t.icon+'"></i></span>')},d=function(){o.configureInline||e.isSubmitRequired(o.selector,!0)},r=function(){c(o.selector).find(".drts-popover-processed").sabaiPopover("hide")},p={items:"> .drts-display-element",placeholder:"drts-display-element-placeholder",opacity:.8,handle:".drts-display-element-handle",tolerance:"intersect",zIndex:99999,start:function(e,t){var a=t.helper.find(".drts-display-element-title").outerHeight()-2;n=!0,r(),t.helper.height(a).css({overflow:"hidden",width:t.helper.find(".drts-display-element-handle").outerWidth()+32}),t.placeholder.height(a),t.item.data("element-width")&&t.placeholder.css("width",t.item.data("element-width"))},update:function(e,t){d(!0)},over:function(e,t){var a=c(this);a.data("child-element-type")&&-1===c.inArray(t.item.data("element-type"),a.data("child-element-type"))||a.data("child-element-name")&&t.item.data("element-name")!==a.data("child-element-name")||a.data("child-element-attr")&&!t.item.data(a.data("child-element-attr"))||t.item.data("parent-element-name")&&a.closest(".drts-display-element").data("element-name")!==t.item.data("parent-element-name")?(t.item.find(".drts-display-element-handle").css("cursor","no-drop"),t.placeholder.addClass(DRTS.bsPrefix+"bg-danger")):(t.item.find(".drts-display-element-handle").css("cursor","move"),t.placeholder.removeClass(DRTS.bsPrefix+"bg-danger"))},out:function(e,t){t.item.css("cursor","move")},stop:function(e,t){n=!1,t.item.css({overflow:"visible",cursor:"auto"})},receive:function(e,t){var a=c(this);(a.data("child-element-type")&&-1===c.inArray(t.item.data("element-type"),a.data("child-element-type"))||a.data("child-element-name")&&t.item.data("element-name")!==a.data("child-element-name")||a.data("child-element-attr")&&!t.item.data(a.data("child-element-attr"))||t.item.data("parent-element-name")&&a.closest(".drts-display-element").data("element-name")!==t.item.data("parent-element-name"))&&t.sender.sortable("cancel")}};c(".drts-display-element-wrapper",o.selector).each(function(){var e=c(this).sortable(p);e.data("child-element-name")||e.sortable("option","connectWith",o.selector+" .drts-display-element-wrapper:not([data-child-element-name])")}),c(".drts-display-display",o.selector).on("click",".drts-display-element-delete",function(){if(!confirm(o.deleteConfirm))return!1;r();var e=c(this).closest(".drts-display-element");return e.fadeTo("fast",0,function(){e.slideUp("medium",function(){e.remove()})}),d(),!1}),c(DRTS).on("display_element_created.sabai",function(e,t){t.target.hasClass("drts-display-element-settings-inline")&&t.target.empty().hide();var a='.drts-display-display[data-display-id="'+t.result.display_id+'"]';t.result.parent_id&&(a+=' .drts-display-element[data-element-id="'+t.result.parent_id+'"]'),a+=" > .drts-display-element-wrapper";var l=c(o.selector).find(a);if(l.length){var n=function a(t,e){var l='<div class="drts-display-element" data-element-id="" data-element-type=""><div class="drts-display-element-title"><span class="drts-display-element-handle"><i class="fas fa-arrows-alt fa-fw fa-lg"></i> <span class="drts-display-element-label"></span></span></div><div class="drts-display-element-control"><div class="drts-bs-btn-group"><button type="button" class="drts-display-element-info drts-bs-btn drts-bs-btn-info drts-bs-btn-sm"><i class="fas fa-info fa-fw"></i></button><button type="button" class="drts-display-element-edit drts-bs-btn drts-bs-btn-primary drts-bs-btn-sm"><i class="fas fa-cog fa-fw"></i></button><button type="button" class="drts-display-element-delete drts-bs-btn drts-bs-btn-danger drts-bs-btn-sm"><i class="fas fa-trash-alt fa-fw"></i></button><button type="button" class="drts-display-add-element drts-bs-btn drts-bs-btn-success drts-bs-btn-sm" rel="sabaitooltip" title="" data-original-title="'+o.addElementTitle+'" data-placement="right"><i class="fas fa-plus fa-fw"></i></button></div></div><div class="drts-display-element-settings-inline"></div><input type="hidden" name="'+o.name+'[]" value="" /></div>',n=c(l).attr("data-element-id",t.id).attr("data-element-type",t.type).attr("data-element-name",t.name).attr("data-element-label",t.label).data("element-data",t.data).addClass("drts-display-element-name-"+t.name).toggleClass("drts-display-element-dimmed",t.dimmed).find('input[name="'+o.name+'[]"]').val(t.id).end().appendTo(e).find('[rel*="sabaitooltip"]').sabaiTooltip({container:e}).end().show();if(t.attr&&c.each(t.attr,function(e,t){n.attr(e,t)}),o.configureInline?n.find(".drts-display-element-settings-inline").attr("id","drts-display-element-settings-inline-"+t.id):n.find(".drts-display-element-settings-inline").remove(),m(n,t,!0),t.containable){l='<input type="hidden" name="'+o.name+'[]" value="__CHILDREN_START__" /><div class="drts-display-element-wrapper"></div><input type="hidden" name="'+o.name+'[]" value="__CHILDREN_END__" />';var i,s=n.addClass("drts-display-element-containable").append(l).find(".drts-display-add-element").attr("data-original-title",t.add_child_label).end().find(" > .drts-display-element-wrapper").sortable(p);if(t.child_element_name){if(n.find(".drts-display-add-element").attr("data-element-name",t.child_element_name),s.attr("child-element-name",t.child_element_name),!DRTS.cache(o.addElementsUrl+"-"+t.child_element_name))c.get(o.addElementUrl,(_defineProperty(i={},DRTS.params.ajax,"#drts-modal"),_defineProperty(i,"element",t.child_element_name),i),function(e){DRTS.cache(o.addElementsUrl+"-"+t.child_element_name,e)})}else if(t.child_element_type){var d,r="string"!=typeof t.child_element_type?JSON.stringify(t.child_element_type):t.child_element_type;if(n.find(".drts-display-add-element").attr("data-element-type",r),s.attr("child-element-type",r),!DRTS.cache(o.listElementsUrl+"-"+r))c.get(o.listElementsUrl,(_defineProperty(d={},DRTS.params.ajax,"#drts-modal"),_defineProperty(d,"type",t.child_element_type),d),function(e){DRTS.cache(o.listElementsUrl+"-"+r,e)});s.sortable("option","connectWith",".drts-display-element-wrapper")}else s.sortable("option","connectWith",".drts-display-element-wrapper");t.children&&c.each(t.children,function(e,t){a(t,s)})}else n.find(".drts-display-add-element").remove();return n}(t.result,l);i(n),DRTS.cache("drts-display-element-name-"+n.data("element-name"),!1),d()}else console.log("Container "+l+" not found.")}),c(DRTS).on("display_element_updated.sabai",function(e,t){var a=c(o.selector).find('.drts-display-element[data-element-id="'+t.result.id+'"]');if(a.length){if(o.configureInline){var l=a.find("> .drts-display-element-settings-inline");l.is(":empty")||(l.slideUp("fast",function(){c(this).empty()}),a.removeClass("drts-display-element-editing-inline"))}if(t.result.attr&&c.each(t.result.attr,function(e,t){a.attr(e,t)}),a.toggleClass("drts-display-element-dimmed",t.result.dimmed),t.result.data){a.data("element-data",t.result.data);var n=a.find(".drts-display-element-info");n.hasClass("drts-popover-processed")&&n.removeClass("drts-popover-processed").sabaiPopover("dispose")}m(a,t.result),i(a),DRTS.cache("drts-display-element-id-"+a.data("element-id"),!1)}}),c(function(){c.get(o.listElementsUrl,_defineProperty({},DRTS.params.ajax,"#drts-modal"),function(e){DRTS.cache(o.listElementsUrl,e),c(".drts-display-display",o.selector).on("click",".drts-display-add-element:not([data-element-name])",a),c(".drts-display-add-element-main",o.selector).prop("disabled",!1)}),c(".drts-display-display",o.selector).on("click",".drts-display-element-edit",l).on("click",".drts-display-add-element[data-element-name]",s).on("click",".drts-display-element-info",function(e){var t=c(this);e.preventDefault(),t.toggleClass("drts-display-element-info-clicked").closest(".drts-display-element-control").toggleClass("drts-display-element-info-clicked"),t.off("hidden.bs.popover").on("hidden.bs.popover",function(){t.removeClass("drts-display-element-info-clicked").closest(".drts-display-element-control").removeClass("drts-display-element-info-clicked")})}).on("click",".drts-display-elements-buttons",function(e){c(this).closest(".drts-display-element-settings-inline").slideUp("fast").empty()}),c(".drts-display-display",o.selector).hoverIntent({selector:".drts-display-element-info",over:function(e){var t=c(this);if(!n)if(c(o.selector).find(".drts-popover-processed").not(this).sabaiPopover("hide"),t.hasClass("drts-popover-processed"))t.sabaiPopover("show");else{var a=t.closest(".drts-display-element"),d=c("<table></table>"),r=a.data("element-data");d.attr("class","drts-display-element-data "+DRTS.bsPrefix+"table "+DRTS.bsPrefix+"table-bordered "+DRTS.bsPrefix+"table-sm "+DRTS.bsPrefix+"m-0"),Object.keys(r).forEach(function(n){var i=!0,e=Object.keys(r[n].value),s=e.length;e.forEach(function(e){var t=c("<td></td>").text(r[n].value[e].label+":"),a=c("<td></td>"),l=c("<tr></tr>").append(t).append(a).appendTo(d);r[n].value[e].is_html?a.html(r[n].value[e].value):r[n].value[e].is_bool?a.html('<i class="fas '+(r[n].value[e].value?"fa-check":"fa-times")+'"></i>'):a.text(r[n].value[e].value),i&&(l.prepend(c('<th class="'+DRTS.bsPrefix+'table-secondary" rowspan="'+s+'"></th>').text(r[n].label)),i=!1)})}),DRTS.popover(t,{html:!0,trigger:"manual",placement:"top",container:o.selector,content:d,template:'<div class="'+DRTS.bsPrefix+'popover"><div class="'+DRTS.bsPrefix+'arrow"></div><div class="'+DRTS.bsPrefix+"popover-body "+DRTS.bsPrefix+'p-1"></div></div>'})}},out:function(e){c(this).hasClass("drts-display-element-info-clicked")||r()}}),c(".drts-display-display",o.selector).on("click",".drts-display-element-title",function(){var e=c(this);e.hasClass("drts-popover-processed")&&e.sabaiPopover("toggle")})})}}(jQuery);