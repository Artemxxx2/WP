"use strict";!function(b){DRTS.Location=DRTS.Location||{},DRTS.Location.map=DRTS.Location.map||function(r){var n=r.getOptions();if(!b(DRTS).data("initialized-"+r.getContainerSelector())){var t=r.getContainer().find(".drts-view-entities-container");if(0<t.length){b(DRTS).on("loaded.sabai",function(t,e){e.target.hasClass("drts-view-entities-container")&&e.target.find(".drts-location-entities-map-container").length&&(!e.append&&e.target.hasClass("drts-location-map-full")&&b(".drts-location-entities-container").animate({scrollTop:0},500,"swing"),e.response.markers&&Array.isArray(e.response.markers)&&(e.append||r.clearMarkers(),r.setMarkers(e.response.markers).draw(e.response.draw_options)),r.getContainer().find(".drts-location-map-control > i").removeClass("fa-spin"),e.append&&n.sticky&&DRTS.Location.stickyScroll(r,!1,!1,!0))});t.hoverIntent(function(t){t.preventDefault();var e=r.getContainer().find(".drts-location-map-container-container");if(e.length&&!e.is(":hidden")){var a=b(t.currentTarget),i=void 0,n=void 0;if(a.hasClass("drts-entity"))i=a,n=0;else{if(!(i=a.closest(".drts-entity")).length)return;n=a.data("key")}var o=r.getMarker(i.data("entity-id")+"-"+n);o&&r.clickMarker(o,!0)}},function(){},".drts-map-marker-trigger, .drts-entity")}r.getContainer().on("marker_click.sabai",function(t,e){if(r.getContainer().find(".drts-highlighted").removeClass("drts-highlighted"),n.scroll_to_item&&e.marker){var a=void 0;if(a=e.marker.get?e.marker.get("entity_id"):e.marker._entity_id){var i=r.getContainer().find('.drts-entity[data-entity-id="'+a+'"]');i.length&&i.is(":visible")&&DRTS.Location.scrollToItem(i,function(){i.addClass("drts-highlighted")},n.sticky)}}}),b(DRTS).data("initialized-"+r.getContainerSelector(),!0)}DRTS.Location.enableMapControls(r,n),n.sticky&&DRTS.Location.stickyScroll(r)},b(DRTS).on("map_drawn.sabai",function(t,e){e.map&&e.map.getContainer().find(".drts-map-map").closest(".drts-location-entities-map-container").length&&(DRTS.Location.map(e.map),b(e.map.getContainerSelector()+"-view-filter-form").on("shown.bs.collapse hidden.bs.collapse",function(){DRTS.Location.stickyScroll(e.map,!0),DRTS.Location.stickyScroll(e.map)}))}),DRTS.Location.stickyScroll=function(t,e,a,i){if(b.fn.stickyScroll){var n=t.getContainer().find(".drts-map-container");n.data("sticky-default-offset")||setTimeout(function(){n.data("sticky-default-offset",n.offset().top)},200);var o=t.getContainer().attr("id")||"stickyScroll";if(e)n.stickyScroll({namespace:o,remove:!0});else{var r=void 0,s=t.getContainer().find(".drts-location-map-container-container");r=s.data("sticky-scroll-top")?s.data("sticky-scroll-top"):0<b("#wpadminbar").length&&"fixed"===b("#wpadminbar").css("position")?b("#wpadminbar").outerHeight():0,s.length;var l={topSpacing:r,stopper:t.getContainer().find(".drts-location-sticky-scroll-stopper"),namespace:o,useDefaultOffset:i,parent:".drts-location-map-container-container",child:".drts-map-map"};void 0!==a&&a||"undefined"==typeof imagesLoaded?n.stickyScroll(l):b("body").imagesLoaded(function(){n.stickyScroll(l)})}}},DRTS.Location.enableMapControls=function(f,p){if(!f.getContainer().find(".drts-location-map-controls").length){var t=b('<div class="drts-location-map-controls"></div>');if(p.fullscreen){var e=b('<button type="button" class="'+DRTS.bsPrefix+"d-none "+DRTS.bsPrefix+"d-sm-block "+DRTS.bsPrefix+"btn "+DRTS.bsPrefix+"btn-sm "+DRTS.bsPrefix+'btn-light drts-location-map-control" data-action="fullscreen" rel="sabaitooltip" data-placement="right"><i class="fas fa-expand"></i></button>'),a=b('<button type="button" class="'+DRTS.bsPrefix+"d-none "+DRTS.bsPrefix+"d-sm-block "+DRTS.bsPrefix+"btn "+DRTS.bsPrefix+"btn-sm "+DRTS.bsPrefix+'btn-light drts-location-map-control" data-action="exit_fullscreen" rel="sabaitooltip" data-placement="right"><i class="fas fa-compress"></i></button>');t.append(e.prop("title",p.text_control_fullscreen||"Full screen")),t.append(a.prop("title",p.text_control_exit_fullscreen||"Exit full screen"))}var i=b('<button type="button" class="'+DRTS.bsPrefix+"btn "+DRTS.bsPrefix+"btn-sm "+DRTS.bsPrefix+'btn-light drts-location-map-control" style="display:none;" data-action="update" rel="sabaitooltip" data-placement="right"><i class="fas fa-sync"></i></button>'),n=b('<button type="button" class="'+DRTS.bsPrefix+"btn "+DRTS.bsPrefix+"btn-sm "+DRTS.bsPrefix+'btn-light drts-location-map-control" style="display:none;" data-action="geolocate" rel="sabaitooltip" data-placement="right"><i class="fas fa-location-arrow"></i></button>');t.append(i.prop("title",p.text_control_search_this_area||"Search this area")),t.append(n.prop("title",p.text_control_search_my_location||"Search my location")),f.getContainer().find(".drts-map-container").prepend(t);var o=b('.drts-view-filter-form[data-entities-container="'+f.getContainerSelector()+'"]'),m=!1;if(0<o.length){var u=o.find(".drts-view-filter-form-field-type-location-address");if(0<u.length&&(m=!0,u.data("search-my-loc")&&(!navigator.geolocation||"https:"!==document.location.protocol&&"localhost"!==document.location.hostname||t.find('.drts-location-map-control[data-action="geolocate"]').show()),u.data("search-this-area")))if(u.data("search-this-area-drag")){var r=void 0;f.getContainer().on("map_dragend.sabai",function(t,e){r=setTimeout(function(){b(".drts-location-map-control[data-action='update']",f.getContainerSelector()).click()},1e3)}),f.getContainer().on("map_mousedown.sabai",function(t,e){r&&clearTimeout(r)})}else t.find('.drts-location-map-control[data-action="update"]').show()}var g=f.getContainer().find(".drts-map-map"),h=g.outerHeight(),v=g.outerWidth();return t.on("click",".drts-location-map-control",function(t){t.preventDefault();var e=b(this);switch(e.data("action")){case"update":case"geolocate":if(!m)break;var a=b('.drts-view-filter-form[data-entities-container="'+f.getContainerSelector()+'"]');if(!a.length)return this;switch(a.find(".drts-view-filter-form-field-type-location-address").each(function(){DRTS.View.removeFilter(a,b(this).data("view-filter-name"))}),e.find("> i").addClass("fa-spin"),e.data("action")){case"update":var i=f.getSouthWest(),n=f.getNorthEast();a.find(".drts-location-text-viewport").val([i[0],i[1],n[0],n[1]].join(",")).end().find(".drts-location-text-center").val("").end().find(".drts-location-text-radius").val("").end().find(".drts-location-text-zoom").val(f.getZoom()).end().find(".drts-location-text-input").val(u.data("search-this-area-label")),a.find('input[name^="search_location_location"]').val("").end().submit();break;case"geolocate":navigator.geolocation.getCurrentPosition(function(t){var e=a.find(".drts-location-text-radius");a.find(".drts-location-text-viewport").val("").end().find(".drts-location-text-center").val(t.coords.latitude+","+t.coords.longitude).end().find(".drts-location-text-zoom").val(7).end().find(".drts-location-text-input").val(u.data("search-my-loc-label")),e.length&&!e.val()&&e.val(0<e.data("default-radius")?e.data("default-radius"):5),a.find('input[name^="search_location_location"]').val("").end().submit()},function(t){e.find("> i").removeClass("fa-spin"),1!==t.code&&DRTS.flash(t.message+" ("+t.code+")","danger")},{enableHighAccuracy:!0,timeout:1e4,maximumAge:1/0})}break;case"fullscreen":case"exit_fullscreen":var o=f.getContainer().find(".drts-view-entities-container"),r=o.hasClass("drts-view-entities-container-map"),s=r?null:o.find(".drts-location-map-container-container"),l=o.find(".drts-location-entities-map-container");switch(e.data("action")){case"fullscreen":h=g.outerHeight(),v=g.outerWidth();var d=b("#wpadminbar").length?b("#wpadminbar").outerHeight(!0):0;0<l.length&&l.data("fullscreen-offset")&&(d=l.data("fullscreen-offset"));var c=b(window).outerHeight()-d;o.addClass("drts-location-map-full").css("top",d).toggleClass("drts-location-map-full-no-filter",0===b(f.getContainerSelector()+"-view-filter-form").length),r||(o.find(".drts-location-entities-container").outerHeight(c).find(".drts-location-entities").before(o.find(".drts-view-entities-header")).before(o.find(".drts-view-entities-filter-form")).after(o.find(".drts-view-entities-footer")).end().end(),s.length&&(o.find(".drts-location-entities-with-map").removeClass("drts-location-entities-with-map-top drts-location-entities-with-map-bottom").end().find(".drts-location-entities-container").removeClass(DRTS.bsPrefix+"col-sm-"+(12-s.data("span"))).addClass(DRTS.bsPrefix+"col-sm-"+(12-s.data("fullscreen-span"))),s.removeClass(DRTS.bsPrefix+"col-sm-"+s.data("span")).addClass(DRTS.bsPrefix+"col-sm-"+s.data("fullscreen-span")),p.sticky&&DRTS.Location.stickyScroll(f,!0))),o.find(".drts-map-map").outerWidth("100%").outerHeight(c),b(window).on("resize.sabai",{container:o,offset:d},function(t){var e=b(window).outerHeight()-t.data.offset;t.data.container.find(".drts-location-entities-container").outerHeight(e).end().find(".drts-map-map").outerHeight(e)}),b("body").css("overflow","hidden").addClass("_drts-location-map-full"),f.onResized(),b(DRTS).trigger("location_fullscreen.sabai",{container:f.getContainer()});break;case"exit_fullscreen":o.removeClass("drts-location-map-full drts-location-map-full-no-filter").find(".drts-map-map").outerWidth(v).outerHeight(h),r||(o.find("> .drts-view-entities").before(o.find(".drts-view-entities-header")).before(o.find(".drts-view-entities-filter-form")).after(o.find(".drts-view-entities-footer")).end().find(".drts-location-entities-container").css("height","100%"),s.length&&(o.find(".drts-location-entities-with-map").toggleClass("drts-location-entities-with-map-top","top"===s.data("position")).toggleClass("drts-location-entities-with-map-bottom","bottom"===s.data("position")).end().find(".drts-location-entities-container").removeClass(DRTS.bsPrefix+"col-sm-"+(12-s.data("fullscreen-span"))).addClass(DRTS.bsPrefix+"col-sm-"+(12-s.data("span"))),s.removeClass(DRTS.bsPrefix+"col-sm-"+s.data("fullscreen-span")).addClass(DRTS.bsPrefix+"col-sm-"+s.data("span")),p.sticky&&DRTS.scrollTo(o,null,null,function(){DRTS.Location.stickyScroll(f,!1,!0)}))),b(window).off("resize.sabai"),b("body").css("overflow","").removeClass("_drts-location-map-full"),f.onResized(),b(DRTS).trigger("location_exit_fullscreen.sabai",{container:f.getContainer()})}f.draw()}}),b(window).on("entity_reset_form_field.sabai",function(t,e){if("filter_location_address"===e){var a=b('.drts-view-filter-form[data-entities-container="'+f.getContainerSelector()+'"]');if(!a.length)return this;a.find(".drts-location-text-viewport").val("").end().find(".drts-location-text-center").val("").end().find(".drts-location-text-radius").val("").end().find(".drts-location-text-zoom").val("").end().find(".drts-location-text-input").val("")}}),t}},DRTS.Location.scrollToItem=function(t,e,a){var i=t.closest(".drts-view-entities-container");if(i.length&&!i.hasClass("drts-view-entities-container-map"))if(i.hasClass("drts-location-map-full")){var n=i.find(".drts-location-entities-container");n.length&&n.animate({scrollTop:n.scrollTop()-n.offset().top+t.offset().top},500,"swing",e)}else{var o,r=i.find(".drts-location-map-container-container");r.data("scroll-offset")?o=r.data("scroll-offset"):(o=0<b("#wpadminbar").length&&"fixed"===b("#wpadminbar").css("position")?b("#wpadminbar").outerHeight():0,o+=10),a&&"xs"!==DRTS.getScreenSize()&&"top"===r.data("position")&&(o+=r.find(".drts-map-map").outerHeight()),b("html,body").animate({scrollTop:t.offset().top-o},500,"swing",e)}}}(jQuery);