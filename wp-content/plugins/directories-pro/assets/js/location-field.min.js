"use strict";var _createClass=function(){function r(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,o){return t&&r(e.prototype,t),o&&r(e,o),e}}(),_get=function e(t,o,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,o);if(void 0===n){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,o,r)}if("value"in n)return n.value;var i=n.get;return void 0!==i?i.call(r):void 0};function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}!function(s){function o(e){_classCallCheck(this,o);var r=_possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,e));r.field.find(".drts-location-find-address").click(function(o){var n=[],e=r.field.closest(".drts-location-address-container");return e.length||(e=r.field),e.find(".drts-location-find-address-component").each(function(e,t){var o=s(t),r=void 0;if("select"===t.tagName.toLowerCase()){if(!o.val())return!0;r=s.trim(o.find("option:selected").text())}else r=s.trim(o.val());r.length&&n.push(r)}),n.length&&(DRTS.ajaxLoader(o.currentTarget),DRTS.Location.api.geocode(s.trim(n.join(" ")),function(e,t){DRTS.ajaxLoader(o.currentTarget,!0),console.log("Geocoding results:",e),t&&console.log("Geocoding results (viewport):",t),r.setMarker(e).updateFields(e).updateAddressFields(e,!!o.currentTarget.getAttribute("data-overwrite-fields")).updateTimezoneField(e),r.map.draw({zoom:r.map.getZoom()})},function(e){DRTS.ajaxLoader(o.currentTarget,!0),r._showApiError(e)})),!1}),r.field.find(".drts-location-get-address").click(function(){var e=r.map.getMarkerLatlng();return e&&r.updateFields(e).updateAddressFields(e,!0).updateTimezoneField(e),!1}),r.field.find(".drts-location-clear-address").click(function(){return r.updateFields(["",""],"").updateAddressFields("",!0).updateTimezoneField(),r.map.clearMarkers(),!1}),!navigator.geolocation||"https:"!==document.location.protocol&&"localhost"!==document.location.hostname||r.field.find(".drts-location-geolocate").show().click(function(o){return DRTS.ajaxLoader(o.currentTarget),navigator.geolocation.getCurrentPosition(function(e){DRTS.ajaxLoader(o.currentTarget,!0);var t=[e.coords.latitude,e.coords.longitude];console.log("Geolocation results:",t),r.setMarker(t).updateFields(t).updateAddressFields(t,!!o.currentTarget.getAttribute("data-overwrite-fields")).updateTimezoneField(t),r.map.draw({zoom:r.map.getZoom()})},function(e){DRTS.ajaxLoader(o.currentTarget,!0),1!==e.code&&DRTS.flash(e.message,"danger"),console.log(e.message+" ("+e.code+")")},{enableHighAccuracy:!0,timeout:1e4,maximumAge:1/0}),!1});var t=r.field.find(".drts-location-text-input");return t.length&&DRTS.Location.api.autocomplete(t,function(e){console.log("Autocomplete results:",e),r.setMarker(e.latlng).updateFields(e.latlng).updateTimezoneField(e.latlng)._setAddressComponentValues(e,!0),r.map.draw({zoom:r.map.getZoom()})}),r}DRTS.Location.field=(_inherits(o,DRTS.Map.field),_createClass(o,[{key:"_onMapClicked",value:function(e){return _get(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"_onMapClicked",this).call(this,e).updateAddressFields(e,!1).updateTimezoneField(e)}},{key:"_onLatLngFieldModified",value:function(e){return _get(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"_onLatLngFieldModified",this).call(this,e).updateAddressFields(e,!1).updateTimezoneField(e)}},{key:"updateTimezoneField",value:function(e){var t=this,o=this.field.find(".drts-location-address-timezone select");return o.length&&(e?DRTS.Location.api.getTimezone(e,function(e){console.log("Time zone: "+e),o.val(e)},function(e){t._showApiError(e),o.val("")}):o.val("")),this}},{key:"updateAddressFields",value:function(e,t){var o=this;return e?DRTS.Location.api.reverseGeocode(e,function(e){console.log("Reverse geocoding results:",e),o._setAddressComponentValues(e,t)},function(e){o._showApiError(e)}):this._setAddressComponentValues([],t),this}},{key:"_showApiError",value:function(e){return console.log(e),DRTS.flash(e.message,"danger",1e4),this}},{key:"_setAddressComponentValues",value:function(e,t){var o=!0,r=!1,n=void 0;try{for(var a,i=["address","street","city","province","zip","country"][Symbol.iterator]();!(o=(a=i.next()).done);o=!0){var l=a.value;this._setAddressComponentValue(l,e[l]||"",t,e)}}catch(e){r=!0,n=e}finally{try{!o&&i.return&&i.return()}finally{if(r)throw n}}return this}},{key:"_setAddressComponentValue",value:function(r,n,a,i){var l=[];return this.field.find(".drts-location-address-"+r).each(function(e,t){var o=s(t);(a||""===o.val()||"hidden"===o.attr("type")||o.closest(".drts-map-location").length)&&(o.data("format")&&(n=(n=o.data("format").replace(/{(.*?)}/g,function(e,t){return t in i?i[t]:""})).replace(/\s+/g," ").trim().replace(/(^,)|(,$)/g,"").trim()),"select"===t.tagName.toLowerCase()?o.find("option").each(function(e,t){if(t.value===n||t.innerHTML===n)return o.val(t.value),l.push(r),!1}):(o.val(n),l.push(r)))}),l}}]),o)}(jQuery);