"use strict";!function(y){DRTS.Location=DRTS.Location||{},DRTS.Location.textfield=DRTS.Location.textfield||function(t){var n=y(t);if(n.length){var i,l=n.find(".drts-location-text-input"),c=n.find(".drts-location-text-center"),g=n.find(".drts-location-text-viewport"),d=n.find(".drts-location-text-zoom"),o=n.find(".drts-location-text-radius"),r=o.hasClass("drts-location-text-radius-slider"),u=function(){r?o.data("ionRangeSlider").reset():o.val("")};if(l.length){var v={suggest_place:void 0===n.data("suggest-place")||(n.data("suggest-place")||!1),suggest_place_header:n.data("suggest-place-header")||"",suggest_place_footer:n.data("suggest-place-footer")||"",suggest_place_icon:n.data("suggest-place-icon")||"fas fa-map-pin",suggest_place_country:n.data("suggest-place-country")||null,suggest_place_minlength:n.data("suggest-place-minlength")||1,suggest_location:n.data("suggest-location"),suggest_location_header:n.data("suggest-location-header")||"",suggest_location_icon:n.data("suggest-location-icon")||"",suggest_location_url:n.data("suggest-location-url")||null,suggest_location_count:n.data("suggest-location-count")||null,suggest_location_parents:n.data("suggest-location-parents")||!1,geolocation:void 0===n.data("geolocation")||(n.data("geolocation")||!1)},p=n.find(".drts-location-text-term-id"),h=n.find(".drts-location-text-taxonomy"),f=n.find(".drts-clear").css("visibility",0<l.val().length?"visible":"hidden"),e=[];if(v.suggest_location&&v.suggest_location_url){var a={},s=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("title","pt"),queryTokenizer:Bloodhound.tokenizers.whitespace,prefetch:{url:v.suggest_location_url}});v.suggest_location_header&&(a.header="<h4>"+v.suggest_location_header+"</h4>"),a.suggestion=function(t){var e=t.title;v.suggest_location_count&&(e+=" ("+(t.count||"0")+")"),v.suggest_location_parents&&t.pt&&(e=t.pt.join(" -> ")+" -> "+e);var a,o=y("<div/>").html(y("<span />").text(e));return t.icon_src?a=y("<img/>").attr("class","drts-icon drts-icon-sm").attr("src",t.icon_src):v.suggest_location_icon&&(a=y("<i/>").attr("class","drts-icon drts-icon-sm "+v.suggest_location_icon)),a&&o.prepend(a),o[0].outerHTML},e.push({name:v.suggest_location,source:function(t,e,a){0<t.length&&s.search(t,e,a)},display:"title",templates:a,limit:n.data("suggest-location-num")||100})}if(v.suggest_place){var _={};v.suggest_place_header&&(_.header=y("<h4/>").text(v.suggest_place_header)[0].outerHTML),v.suggest_place_icon&&(_.suggestion=function(t){var e=y("<div/>");return e.append(y("<i/>").attr("class","drts-icon drts-icon-sm "+v.suggest_place_icon)).append(y("<span/>").text(t.text)),e[0].outerHTML}),v.suggest_place_footer&&(_.footer=y("<div/>").attr("class","tt-footer").css({"text-align":"right",margin:"0 5px 3px"}).html(v.suggest_place_footer)[0].outerHTML),e.push({name:"place",display:"text",templates:_,source:function(t,e,a){t.length<v.suggest_place_minlength||DRTS.Location.api.getSuggestions(t,a)}})}if(v.geolocation&&navigator.geolocation&&("https:"===document.location.protocol||"localhost"===document.location.hostname)){var m=function(){var e=!1;l.addClass("drts-ajax-loading"),navigator.geolocation.getCurrentPosition(function(a){l.removeClass("drts-ajax-loading"),e=i=!0,DRTS.Location.api.reverseGeocode([a.coords.latitude,a.coords.longitude],function(t){l.val(t.address).typeahead("val",t.address),h.val(""),p.val(""),g.val(""),d.val(""),r||o.val()&&!(o.val()<5)||o.val(5<o.data("default-radius")?o.data("default-radius"):5),f.css("visibility",0<l.val().length?"visible":"hidden");var e=a.coords.latitude+","+a.coords.longitude;e!==c.val()&&(c.val(e),l.trigger("change"))},function(t){DRTS.flash(t.message,"danger")})},function(t){l.removeClass("drts-ajax-loading"),e||1!==t.code&&DRTS.flash(t.message,"danger"),console.log(t.message+" ("+t.code+")")},{enableHighAccuracy:!0,timeout:1e4,maximumAge:1/0})};e.push({name:"geolocate",source:function(t,e){i||e([{content:""}])},display:"content",templates:{suggestion:function(){var t=y("<i/>").attr("class","drts-icon drts-icon-sm fas fa-location-arrow");return y("<div/>").html(y("<span/>").text(n.data("geolocation-text")||"Current location")).prepend(t)[0].outerHTML}}})}else n.addClass("drts-location-no-geolocation");e.length?(l.typeahead({highlight:!0,minLength:0},e),l.on("typeahead:select",function(t,e,a){if(c.val(""),g.val(""),d.val(""),i=!1,r||u(),a===v.suggest_location)h.val(v.suggest_location),p.val(e.id);else if("place"===a)if(h.val(""),p.val(""),e.latlng)c.val(e.latlng[0]+","+e.latlng[1]);else{var o=function(t,e){c.val(t.join(",")),e&&g.val(e.join(","))},s=function(t){console.log(t)};DRTS.Location.api.geocodeSuggestion&&n.data("suggest-place-geocode")?DRTS.Location.api.geocodeSuggestion(e,o,s):DRTS.Location.api.geocode(e.text,o,s)}else"geolocate"===a&&m();f.css("visibility",0<l.val().length?"visible":"hidden")}).on("keyup",function(t){13!==t.keyCode&&27!==t.keyCode&&32!==t.keyCode&&(h.val(""),p.val(""),c.val(""),g.val(""),d.val(""),r||u(),f.css("visibility",0<l.val().length?"visible":"hidden")),i=!1}).on("typeahead:open",function(){l.closest(".twitter-typeahead").addClass("twitter-typeahead-open")}).on("typeahead:close",function(){l.closest(".twitter-typeahead").removeClass("twitter-typeahead-open")}),f.click(function(){h.val(""),p.val(""),c.val(""),g.val(""),d.val(""),r||u(),f.css("visibility","hidden"),l.typeahead("val","").focus().trigger("change"),i=!1,l.typeahead("open")})):(l.bind("keyup",function(t){13!==t.keyCode&&27!==t.keyCode&&32!==t.keyCode&&f.css("visibility",0<l.val().length?"visible":"hidden")}),f.click(function(){f.css("visibility","hidden"),l.val("").focus().trigger("change")})),r&&o.on("change",function(){d.val()||g.val("")})}n.on("entity_reset_form_field.sabai",function(){l.length&&(e.length?l.typeahead("val",""):l.val(""),h.val(""),p.val("")),c.val(""),g.val(""),d.val(""),u()})}}}(jQuery);